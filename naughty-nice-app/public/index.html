<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üéÖ Naughty or Nice? - Multi-Platform Compliance Engine</title>
  <link href="https://fonts.googleapis.com/css2?family=Mountains+of+Christmas:wght@400;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --nice-green: #2ecc71;
      --naughty-red: #e74c3c;
      --gold: #f39c12;
      --snow-white: #ecf0f1;
      --dark-green: #1a472a;
      --christmas-red: #c41e3a;
      --twitter-blue: #1da1f2;
      --reddit-orange: #ff4500;
      --github-purple: #6e5494;
      --news-gray: #607d8b;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Poppins', sans-serif;
      min-height: 100vh;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      color: white;
      overflow-x: hidden;
    }

    .snowflakes {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none; z-index: 1; overflow: hidden;
    }

    .snowflake {
      position: absolute; top: -10px; color: white; font-size: 1em;
      animation: fall linear infinite; opacity: 0.8;
    }

    @keyframes fall { to { transform: translateY(100vh) rotate(360deg); } }

    .container {
      max-width: 1200px; margin: 0 auto; padding: 50px 30px;
      position: relative; z-index: 10;
    }

    header { text-align: center; margin-bottom: 50px; }

    h1 {
      font-family: 'Mountains of Christmas', cursive;
      font-size: 5rem; color: var(--christmas-red);
      text-shadow: 4px 4px 0 var(--gold), 8px 8px 0 rgba(0,0,0,0.2);
      margin-bottom: 15px; animation: glow 2s ease-in-out infinite alternate;
    }

    @keyframes glow {
      from { text-shadow: 3px 3px 0 var(--gold), 6px 6px 0 rgba(0,0,0,0.2), 0 0 20px rgba(243, 156, 18, 0.3); }
      to { text-shadow: 3px 3px 0 var(--gold), 6px 6px 0 rgba(0,0,0,0.2), 0 0 40px rgba(243, 156, 18, 0.6); }
    }

    .subtitle { font-size: 1.5rem; color: var(--snow-white); opacity: 0.9; }

    .platforms-badges {
      display: flex; justify-content: center; gap: 15px; margin-top: 15px; flex-wrap: wrap;
    }

    .platform-badge {
      padding: 10px 20px; border-radius: 25px; font-size: 1.1rem; font-weight: 500;
      display: flex; align-items: center; gap: 10px;
    }

    .platform-badge.twitter { background: rgba(29, 161, 242, 0.3); border: 1px solid var(--twitter-blue); }
    .platform-badge.reddit { background: rgba(255, 69, 0, 0.3); border: 1px solid var(--reddit-orange); }
    .platform-badge.news { background: rgba(96, 125, 139, 0.3); border: 1px solid var(--news-gray); }
    .platform-badge.github { background: rgba(110, 84, 148, 0.3); border: 1px solid var(--github-purple); }

    .search-section {
      background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px);
      border-radius: 25px; padding: 45px; margin-bottom: 40px;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .search-box { display: flex; gap: 20px; max-width: 800px; margin: 0 auto; }

    .search-input {
      flex: 1; padding: 22px 32px; font-size: 1.4rem; border: none;
      border-radius: 50px; background: rgba(255, 255, 255, 0.95);
      color: #333; outline: none; transition: all 0.3s ease;
    }

    .search-input::placeholder { color: #999; }
    .search-input:focus { transform: scale(1.02); box-shadow: 0 0 30px rgba(255, 255, 255, 0.3); }

    .search-btn {
      padding: 22px 50px; font-size: 1.3rem; font-weight: 600; border: none;
      border-radius: 50px; background: linear-gradient(135deg, var(--christmas-red), #a01830);
      color: white; cursor: pointer; transition: all 0.3s ease;
      display: flex; align-items: center; gap: 12px;
    }

    .search-btn:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(196, 30, 58, 0.4); }
    .search-btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }

    .loading { display: none; text-align: center; padding: 70px; }
    .loading.active { display: block; }

    .loading-spinner {
      width: 90px; height: 90px; border: 5px solid rgba(255, 255, 255, 0.1);
      border-top-color: var(--gold); border-radius: 50%;
      animation: spin 1s linear infinite; margin: 0 auto 25px;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    .loading-text { font-size: 1.5rem; color: var(--snow-white); }
    .loading-sources { margin-top: 25px; font-size: 1.2rem; opacity: 0.8; }

    .results { display: none; animation: fadeIn 0.5s ease; }
    .results.active { display: block; }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

    .user-card {
      background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px);
      border-radius: 25px; padding: 35px; margin-bottom: 35px;
      display: flex; align-items: center; gap: 30px;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .user-avatar {
      width: 120px; height: 120px; border-radius: 50%;
      border: 5px solid var(--gold); object-fit: cover;
    }

    .user-info h2 { font-size: 2.2rem; margin-bottom: 8px; }
    .user-handle { color: var(--gold); font-size: 1.3rem; margin-bottom: 10px; }
    .user-stats { display: flex; gap: 25px; font-size: 1.1rem; opacity: 0.8; }

    .verdict-card {
      background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px);
      border-radius: 25px; padding: 50px; padding-bottom: 180px; text-align: center; margin-bottom: 35px;
      border: 2px solid rgba(255, 255, 255, 0.2); position: relative;
    }

    .verdict-card.nice { border-color: var(--nice-green); box-shadow: 0 0 60px rgba(46, 204, 113, 0.3); }
    .verdict-card.naughty { border-color: var(--naughty-red); box-shadow: 0 0 60px rgba(231, 76, 60, 0.3); }

    .verdict-icon { font-size: 7rem; margin-bottom: 20px; animation: bounce 1s ease infinite; }
    @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

    .verdict-text {
      font-family: 'Mountains of Christmas', cursive;
      font-size: 5rem; font-weight: 700; margin-bottom: 15px;
    }

    .verdict-card.nice .verdict-text { color: var(--nice-green); }
    .verdict-card.naughty .verdict-text { color: var(--naughty-red); }

    .score-display { font-size: 1.8rem; margin-bottom: 30px; }
    .score-number { font-size: 3.5rem; font-weight: 700; color: var(--gold); }

    .score-bar {
      width: 100%; max-width: 500px; height: 22px;
      background: linear-gradient(90deg, var(--naughty-red) 0%, var(--gold) 50%, var(--nice-green) 100%);
      border-radius: 11px; margin: 0 auto; position: relative;
    }

    .score-indicator {
      position: absolute; top: -10px; width: 42px; height: 42px;
      background: white; border-radius: 50%; transform: translateX(-50%);
      display: flex; align-items: center; justify-content: center;
      font-size: 1.4rem; box-shadow: 0 4px 20px rgba(0,0,0,0.3); transition: left 1s ease;
    }

    /* Tabs Navigation */
    .tabs-container {
      background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px);
      border-radius: 25px; margin-bottom: 35px;
      border: 1px solid rgba(255, 255, 255, 0.2); overflow: hidden;
    }

    .tabs-nav {
      display: flex; border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      overflow-x: auto;
    }

    .tab-btn {
      flex: 1; padding: 20px 28px; background: none; border: none;
      color: rgba(255, 255, 255, 0.6); font-size: 1.2rem; font-weight: 500;
      cursor: pointer; transition: all 0.3s ease;
      display: flex; align-items: center; justify-content: center; gap: 12px;
      min-width: 140px; white-space: nowrap;
    }

    .tab-btn:hover { background: rgba(255, 255, 255, 0.05); color: white; }
    .tab-btn.active { background: rgba(255, 255, 255, 0.1); color: white; }
    .tab-btn.hidden { display: none !important; visibility: hidden !important; }
    .tab-btn.active.twitter { border-bottom: 4px solid var(--twitter-blue); }
    .tab-btn.active.reddit { border-bottom: 4px solid var(--reddit-orange); }
    .tab-btn.active.news { border-bottom: 4px solid var(--news-gray); }
    .tab-btn.active.github { border-bottom: 4px solid var(--github-purple); }
    .tab-btn.active.overview { border-bottom: 4px solid var(--gold); }
    .tab-btn.active.santa-chat { border-bottom: 4px solid var(--christmas-red); }

    .tab-icon { font-size: 1.6rem; }
    .tab-status { font-size: 0.9rem; margin-left: 8px; }
    .tab-status.found { color: var(--nice-green); }
    .tab-status.not-found { color: var(--naughty-red); }

    .tab-content { display: none; padding: 35px; }
    .tab-content.active { display: block; animation: fadeIn 0.3s ease; }

    /* Overview Tab */
    .overview-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 35px; }

    .source-card {
      background: rgba(0, 0, 0, 0.2); border-radius: 20px; padding: 28px;
      text-align: center; border: 3px solid transparent; transition: all 0.3s ease;
      cursor: pointer;
    }

    .source-card:hover { transform: translateY(-5px); }
    .source-card.found { border-color: rgba(255, 255, 255, 0.3); }
    .source-card.not-found { opacity: 0.5; }

    .source-card.twitter.found { border-color: var(--twitter-blue); }
    .source-card.reddit.found { border-color: var(--reddit-orange); }
    .source-card.news.found { border-color: var(--news-gray); }
    .source-card.github.found { border-color: var(--github-purple); }

    .source-icon { font-size: 3rem; margin-bottom: 15px; }
    .source-name { font-size: 1.2rem; font-weight: 600; margin-bottom: 12px; }
    .source-score { font-size: 2.5rem; font-weight: 700; }
    .source-weight { font-size: 1rem; opacity: 0.7; margin-top: 8px; }
    .source-verdict { font-size: 1rem; margin-top: 8px; padding: 6px 16px; border-radius: 15px; display: inline-block; }
    .source-verdict.nice { background: rgba(46, 204, 113, 0.3); color: var(--nice-green); }
    .source-verdict.naughty { background: rgba(231, 76, 60, 0.3); color: var(--naughty-red); }

    /* Weighted Breakdown Chart */
    .breakdown-chart { margin-top: 35px; }
    .breakdown-title { font-size: 1.5rem; margin-bottom: 20px; text-align: center; }

    .breakdown-bar-container { margin-bottom: 18px; }
    .breakdown-label { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 1.15rem; }
    .breakdown-bar { height: 32px; background: rgba(255, 255, 255, 0.1); border-radius: 16px; overflow: hidden; position: relative; }
    .breakdown-fill { height: 100%; border-radius: 16px; transition: width 1s ease; display: flex; align-items: center; justify-content: flex-end; padding-right: 14px; font-size: 1rem; font-weight: 600; }
    .breakdown-fill.twitter { background: linear-gradient(90deg, rgba(29, 161, 242, 0.3), var(--twitter-blue)); }
    .breakdown-fill.reddit { background: linear-gradient(90deg, rgba(255, 69, 0, 0.3), var(--reddit-orange)); }
    .breakdown-fill.news { background: linear-gradient(90deg, rgba(96, 125, 139, 0.3), var(--news-gray)); }
    .breakdown-fill.github { background: linear-gradient(90deg, rgba(110, 84, 148, 0.3), var(--github-purple)); }

    /* Source Detail Tabs */
    .source-header { display: flex; align-items: center; gap: 20px; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); }
    .source-header-icon { font-size: 3.5rem; }
    .source-header-info h3 { font-size: 1.8rem; margin-bottom: 8px; }
    .source-header-score { font-size: 2.8rem; font-weight: 700; margin-left: auto; }

    .scoring-explanation { background: rgba(0, 0, 0, 0.2); border-radius: 20px; padding: 30px; margin-bottom: 25px; }
    .scoring-explanation h4 { font-size: 1.3rem; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }

    .scoring-factors { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }
    .scoring-factor { background: rgba(255, 255, 255, 0.05); border-radius: 15px; padding: 22px; }
    .scoring-factor-title { font-size: 1.1rem; font-weight: 600; margin-bottom: 12px; display: flex; align-items: center; gap: 10px; }
    .scoring-factor-value { font-size: 2.2rem; font-weight: 700; }
    .scoring-factor-desc { font-size: 0.95rem; opacity: 0.7; margin-top: 8px; }

    .nice-factor .scoring-factor-value { color: var(--nice-green); }
    .naughty-factor .scoring-factor-value { color: var(--naughty-red); }

    .keywords-section { margin-top: 25px; }
    .keywords-section h4 { font-size: 1.2rem; margin-bottom: 15px; }
    .keywords-list { display: flex; flex-wrap: wrap; gap: 12px; }
    .keyword-tag { padding: 8px 18px; border-radius: 25px; font-size: 1rem; }
    .keyword-tag.nice { background: rgba(46, 204, 113, 0.2); color: var(--nice-green); border: 1px solid rgba(46, 204, 113, 0.4); }
    .keyword-tag.naughty { background: rgba(231, 76, 60, 0.2); color: var(--naughty-red); border: 1px solid rgba(231, 76, 60, 0.4); }

    .not-found-message { text-align: center; padding: 60px; opacity: 0.7; }
    .not-found-message .icon { font-size: 4rem; margin-bottom: 20px; }

    .formula-box { background: rgba(0, 0, 0, 0.3); border-radius: 12px; padding: 20px; margin-top: 20px; font-family: monospace; font-size: 1.1rem; text-align: center; }

    .error-message {
      background: rgba(231, 76, 60, 0.2); border: 1px solid var(--naughty-red);
      border-radius: 15px; padding: 20px; text-align: center; color: white; display: none;
    }

    .error-message.active { display: block; }

    /* Shit Poster Stamp */
    .shitpost-stamp {
      display: none;
      margin-top: 40px;
      padding: 25px 45px;
      border: 5px solid #ff4444;
      border-radius: 10px;
      transform: rotate(-2deg);
      background: rgba(255, 68, 68, 0.15);
      box-shadow: 
        inset 0 0 0 3px rgba(255, 68, 68, 0.4),
        0 0 30px rgba(255, 68, 68, 0.4),
        0 0 60px rgba(255, 68, 68, 0.2);
      animation: stampSlam 0.4s ease-out;
      max-width: 380px;
      margin-left: auto;
      margin-right: auto;
    }

    .shitpost-stamp.visible {
      display: block !important;
    }

    @keyframes stampSlam {
      0% { transform: rotate(-2deg) scale(2); opacity: 0; }
      60% { transform: rotate(-2deg) scale(0.95); }
      100% { transform: rotate(-2deg) scale(1); opacity: 1; }
    }

    .stamp-header {
      font-size: 1.1rem;
      font-weight: 700;
      letter-spacing: 4px;
      color: #ff4444;
      text-transform: uppercase;
      margin-bottom: 12px;
      text-shadow: 0 0 10px rgba(255, 68, 68, 0.5);
    }

    .stamp-checkbox-row {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
    }

    .stamp-checkbox {
      width: 38px;
      height: 38px;
      border: 4px solid #ff4444;
      border-radius: 6px;
      background: transparent;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.8rem;
      color: #ff4444;
      font-weight: 900;
      text-shadow: 0 0 8px rgba(255, 68, 68, 0.6);
    }

    .stamp-checkbox.checked::after {
      content: '‚úì';
    }

    .stamp-label {
      font-family: 'Mountains of Christmas', cursive;
      font-size: 2.4rem;
      font-weight: 700;
      color: #ff4444;
      text-shadow: 0 0 15px rgba(255, 68, 68, 0.5), 2px 2px 0 rgba(0,0,0,0.2);
    }

    /* Reply Guy Stamp (Nice) */
    .replyguy-stamp {
      display: none;
      margin-top: 40px;
      padding: 25px 45px;
      border: 5px solid #2ecc71;
      border-radius: 10px;
      transform: rotate(2deg);
      background: rgba(46, 204, 113, 0.15);
      box-shadow: 
        inset 0 0 0 3px rgba(46, 204, 113, 0.4),
        0 0 30px rgba(46, 204, 113, 0.4),
        0 0 60px rgba(46, 204, 113, 0.2);
      animation: stampSlamNice 0.4s ease-out;
      max-width: 380px;
      margin-left: auto;
      margin-right: auto;
    }

    .replyguy-stamp.visible {
      display: block !important;
    }

    @keyframes stampSlamNice {
      0% { transform: rotate(2deg) scale(2); opacity: 0; }
      60% { transform: rotate(2deg) scale(0.95); }
      100% { transform: rotate(2deg) scale(1); opacity: 1; }
    }

    .replyguy-stamp .stamp-header {
      color: #2ecc71;
      text-shadow: 0 0 10px rgba(46, 204, 113, 0.5);
    }

    .replyguy-stamp .stamp-checkbox {
      border-color: #2ecc71;
      color: #2ecc71;
      text-shadow: 0 0 8px rgba(46, 204, 113, 0.6);
    }

    .replyguy-stamp .stamp-label {
      color: #2ecc71;
      text-shadow: 0 0 15px rgba(46, 204, 113, 0.5), 2px 2px 0 rgba(0,0,0,0.2);
    }

    /* Brain Rot Stamp (Naughty) */
    .brainrot-stamp {
      display: none;
      margin-top: 20px;
      padding: 25px 45px;
      border: 5px solid #9b59b6;
      border-radius: 10px;
      transform: rotate(3deg);
      background: rgba(155, 89, 182, 0.15);
      box-shadow: 
        inset 0 0 0 3px rgba(155, 89, 182, 0.4),
        0 0 30px rgba(155, 89, 182, 0.4),
        0 0 60px rgba(155, 89, 182, 0.2);
      animation: stampSlamBrain 0.5s ease-out 0.2s both;
      max-width: 380px;
      margin-left: auto;
      margin-right: auto;
    }

    .brainrot-stamp.visible {
      display: block !important;
    }

    @keyframes stampSlamBrain {
      0% { transform: rotate(3deg) scale(2); opacity: 0; }
      60% { transform: rotate(3deg) scale(0.95); }
      100% { transform: rotate(3deg) scale(1); opacity: 1; }
    }

    .brainrot-stamp .stamp-header {
      color: #9b59b6;
      text-shadow: 0 0 10px rgba(155, 89, 182, 0.5);
    }

    .brainrot-stamp .stamp-checkbox {
      border-color: #9b59b6;
      color: #9b59b6;
      text-shadow: 0 0 8px rgba(155, 89, 182, 0.6);
    }

    .brainrot-stamp .stamp-label {
      color: #9b59b6;
      text-shadow: 0 0 15px rgba(155, 89, 182, 0.5), 2px 2px 0 rgba(0,0,0,0.2);
    }

    footer { text-align: center; margin-top: 50px; opacity: 0.7; font-size: 1.1rem; }

    /* Main Navigation */
    .main-nav {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 40px;
    }

    .main-nav-btn {
      padding: 18px 40px;
      font-size: 1.3rem;
      font-weight: 600;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 50px;
      background: rgba(255, 255, 255, 0.1);
      color: white;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .main-nav-btn:hover {
      background: rgba(255, 255, 255, 0.15);
      transform: translateY(-2px);
    }

    .main-nav-btn.active {
      background: var(--christmas-red);
      border-color: var(--christmas-red);
      box-shadow: 0 10px 30px rgba(196, 30, 58, 0.4);
    }

    .main-view { display: none !important; }
    .main-view.active { display: block !important; }

    /* Santa Chat Styles */
    .chat-container {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 25px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      overflow: hidden;
      max-width: 900px;
      margin: 0 auto;
    }

    .chat-header {
      background: linear-gradient(135deg, var(--christmas-red), #a01830);
      padding: 25px 35px;
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .chat-header-avatar {
      width: 70px;
      height: 70px;
      font-size: 3.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .chat-header-info h2 {
      font-family: 'Mountains of Christmas', cursive;
      font-size: 2rem;
      margin-bottom: 5px;
    }

    .chat-header-info p {
      opacity: 0.9;
      font-size: 1rem;
    }

    .chat-messages {
      height: 500px;
      overflow-y: auto;
      padding: 25px;
      display: flex;
      flex-direction: column;
      gap: 20px;
      background: rgba(0, 0, 0, 0.2);
    }

    .chat-message {
      display: flex;
      gap: 15px;
      animation: fadeIn 0.3s ease;
    }

    .chat-message.user {
      flex-direction: row-reverse;
    }

    .chat-message-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.8rem;
      flex-shrink: 0;
    }

    .chat-message.santa .chat-message-avatar {
      background: var(--christmas-red);
    }

    .chat-message.user .chat-message-avatar {
      background: var(--dark-green);
    }

    .chat-message-content {
      background: rgba(255, 255, 255, 0.1);
      padding: 18px 22px;
      border-radius: 20px;
      max-width: 75%;
      line-height: 1.6;
      font-size: 1.05rem;
    }

    .chat-message.santa .chat-message-content {
      border-bottom-left-radius: 5px;
    }

    .chat-message.user .chat-message-content {
      border-bottom-right-radius: 5px;
      background: rgba(46, 204, 113, 0.2);
    }

    .chat-message-content h3 {
      color: var(--gold);
      margin-bottom: 10px;
      font-size: 1.2rem;
    }

    .chat-message-content strong {
      color: var(--gold);
    }

    .chat-message-content em {
      color: #ff9999;
    }

    .chat-input-area {
      padding: 25px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      gap: 15px;
    }

    .chat-input {
      flex: 1;
      padding: 18px 25px;
      font-size: 1.1rem;
      border: none;
      border-radius: 50px;
      background: rgba(255, 255, 255, 0.95);
      color: #333;
      outline: none;
      transition: all 0.3s ease;
    }

    .chat-input::placeholder {
      color: #888;
    }

    .chat-input:focus {
      box-shadow: 0 0 20px rgba(255, 255, 255, 0.2);
    }

    .chat-send-btn {
      padding: 18px 35px;
      font-size: 1.1rem;
      font-weight: 600;
      border: none;
      border-radius: 50px;
      background: linear-gradient(135deg, var(--christmas-red), #a01830);
      color: white;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .chat-send-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(196, 30, 58, 0.4);
    }

    .chat-send-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .chat-typing {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 15px 20px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 20px;
      width: fit-content;
    }

    .typing-dots {
      display: flex;
      gap: 5px;
    }

    .typing-dot {
      width: 10px;
      height: 10px;
      background: var(--christmas-red);
      border-radius: 50%;
      animation: typingBounce 1.4s infinite ease-in-out;
    }

    .typing-dot:nth-child(1) { animation-delay: 0s; }
    .typing-dot:nth-child(2) { animation-delay: 0.2s; }
    .typing-dot:nth-child(3) { animation-delay: 0.4s; }

    @keyframes typingBounce {
      0%, 80%, 100% { transform: translateY(0); }
      40% { transform: translateY(-8px); }
    }

    .quick-actions {
      padding: 20px 25px;
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .quick-action-btn {
      padding: 10px 20px;
      font-size: 0.95rem;
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 25px;
      background: rgba(255, 255, 255, 0.05);
      color: white;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .quick-action-btn:hover {
      background: rgba(255, 255, 255, 0.15);
      border-color: var(--gold);
    }

    @media (max-width: 768px) {
      .main-nav { flex-direction: column; }
      .main-nav-btn { justify-content: center; }
      .chat-messages { height: 400px; }
      .chat-header { flex-direction: column; text-align: center; padding: 20px; }
      .chat-input-area { flex-direction: column; }
      .chat-send-btn { justify-content: center; }
      .chat-message-content { max-width: 85%; }
    }

    @media (max-width: 768px) {
      h1 { font-size: 3rem; }
      .subtitle { font-size: 1.2rem; }
      .platform-badge { font-size: 0.95rem; padding: 8px 14px; }
      .search-box { flex-direction: column; }
      .search-input { font-size: 1.2rem; padding: 18px 24px; }
      .search-btn { font-size: 1.1rem; padding: 18px 35px; justify-content: center; }
      .user-card { flex-direction: column; text-align: center; }
      .user-avatar { width: 100px; height: 100px; }
      .user-info h2 { font-size: 1.8rem; }
      .verdict-icon { font-size: 5rem; }
      .verdict-text { font-size: 3.5rem; }
      .score-number { font-size: 2.5rem; }
      .overview-grid { grid-template-columns: repeat(2, 1fr); }
      .source-icon { font-size: 2.2rem; }
      .source-score { font-size: 2rem; }
      .scoring-factors { grid-template-columns: 1fr; }
      .tabs-nav { flex-wrap: nowrap; }
      .tab-btn { min-width: 100px; padding: 16px 14px; font-size: 1rem; }
      .tab-icon { font-size: 1.3rem; }
    }
  </style>
</head>
<body>
  <div class="snowflakes" id="snowflakes"></div>
  
  <div class="container">
    <header>
      <h1>üéÖ Naughty or Nice?</h1>
      <p class="subtitle">Santa's Official Naughty or Nice Score Card</p>
    </header>

    <!-- Main Navigation -->
    <div class="main-nav">
      <button class="main-nav-btn active" onclick="switchMainView('analyzer', this)">
        <span>üîç</span> Score Analyzer
      </button>
      <button class="main-nav-btn" onclick="switchMainView('santa-chat', this)">
        <span>üéÖ</span> Santa Chat
      </button>
    </div>

    <!-- Analyzer View -->
    <div class="main-view active" id="view-analyzer">
    <div class="search-section">
      <div class="search-box">
        <input 
          type="text" 
          class="search-input" 
          id="usernameInput" 
          placeholder="Enter username (e.g., elonmusk, nasa, billgates)"
          autocomplete="off"
        >
        <button class="search-btn" id="analyzeBtn" onclick="analyzeUser()">
          <span>üîç</span> Analyze
        </button>
      </div>
    </div>

    <div class="loading" id="loading">
      <div class="loading-spinner"></div>
      <p class="loading-text">üéÑ Santa's elves are checking ALL the lists... üéÑ</p>
      <div class="loading-sources" id="loadingSources">
        Scanning Twitter, Reddit, News, and GitHub...
      </div>
    </div>

    <div class="error-message" id="errorMessage"></div>

    <div class="results" id="results">
      <div class="user-card">
        <img class="user-avatar" id="userAvatar" src="" alt="Profile" referrerpolicy="no-referrer" onerror="this.onerror=null; this.src='https://unavatar.io/' + (this.dataset.username || 'user');">
        <div class="user-info">
          <h2 id="userName"></h2>
          <p class="user-handle" id="userHandle"></p>
          <div class="user-stats">
            <span id="userFollowers"></span>
            <span id="userTweets"></span>
          </div>
        </div>
      </div>

      <div class="verdict-card" id="verdictCard">
        <div class="verdict-icon" id="verdictIcon"></div>
        <div class="verdict-text" id="verdictText"></div>
        <div class="score-display">
          Combined Score: <span class="score-number" id="scoreNumber"></span>/100
        </div>
        <div class="score-bar">
          <div class="score-indicator" id="scoreIndicator">üéÖ</div>
        </div>

        <div class="shitpost-stamp" id="shitpostStamp">
          <div class="stamp-header">‚ò† CERTIFIED ‚ò†</div>
          <div class="stamp-checkbox-row">
            <div class="stamp-checkbox" id="shitpostCheckbox"></div>
            <span class="stamp-label">Shit Poster</span>
          </div>
        </div>

        <div class="brainrot-stamp" id="brainrotStamp">
          <div class="stamp-header">üß† DIAGNOSIS üß†</div>
          <div class="stamp-checkbox-row">
            <div class="stamp-checkbox" id="brainrotCheckbox"></div>
            <span class="stamp-label">Brain Rot</span>
          </div>
        </div>

        <div class="replyguy-stamp" id="replyguyStamp">
          <div class="stamp-header">‚ú® CERTIFIED ‚ú®</div>
          <div class="stamp-checkbox-row">
            <div class="stamp-checkbox" id="replyguyCheckbox"></div>
            <span class="stamp-label">Reply Guy</span>
          </div>
        </div>
      </div>

      <!-- Tabbed Interface -->
      <div class="tabs-container">
        <div class="tabs-nav" id="tabsNav">
          <button class="tab-btn overview active" onclick="switchTab('overview')">
            <span class="tab-icon">üìä</span> Overview
          </button>
          <button class="tab-btn twitter" onclick="switchTab('twitter')">
            <span class="tab-icon">ùïè</span> Twitter
            <span class="tab-status" id="twitterStatus"></span>
          </button>
          <button class="tab-btn reddit" onclick="switchTab('reddit')">
            <span class="tab-icon">üî¥</span> Reddit
            <span class="tab-status" id="redditStatus"></span>
          </button>
          <button class="tab-btn news" onclick="switchTab('news')">
            <span class="tab-icon">üì∞</span> News
            <span class="tab-status" id="newsStatus"></span>
          </button>
          <button class="tab-btn github" onclick="switchTab('github')">
            <span class="tab-icon">üêô</span> GitHub
            <span class="tab-status" id="githubStatus"></span>
          </button>
        </div>

        <!-- Overview Tab -->
        <div class="tab-content active" id="tab-overview">
          <div class="overview-grid" id="overviewGrid"></div>
          <div class="breakdown-chart">
            <div class="breakdown-title">üìà Weighted Score Contribution</div>
            <div id="breakdownBars"></div>
          </div>
        </div>

        <!-- Twitter Tab -->
        <div class="tab-content" id="tab-twitter"></div>

        <!-- Reddit Tab -->
        <div class="tab-content" id="tab-reddit"></div>

        <!-- News Tab -->
        <div class="tab-content" id="tab-news"></div>

        <!-- GitHub Tab -->
        <div class="tab-content" id="tab-github"></div>
      </div>
    </div>

    <footer class="analyzer-footer">
      <div class="platforms-badges">
        <span class="platform-badge twitter">ùïè Twitter (30%)</span>
        <span class="platform-badge reddit">üî¥ Reddit (30%)</span>
        <span class="platform-badge news">üì∞ News (30%)</span>
        <span class="platform-badge github">üêô GitHub (10%)</span>
      </div>
      <p style="margin-top: 20px;">üéÑ Made with holiday cheer for the MCP Jam 2024 üéÑ</p>
      <p id="sourcesCount">Analyzing 4 platforms</p>
    </footer>
    </div><!-- End Analyzer View -->

    <!-- Santa Chat View -->
    <div class="main-view" id="view-santa-chat">
      <div class="chat-container">
        <div class="chat-header">
          <div class="chat-header-avatar">üéÖ</div>
          <div class="chat-header-info">
            <h2>Chat with Santa</h2>
            <p>Ask me to analyze any Twitter user! I'll tell you if they're naughty or nice.</p>
          </div>
        </div>

        <div class="quick-actions">
          <button class="quick-action-btn" onclick="analyzeQuickUser('elonmusk')">@elonmusk</button>
          <button class="quick-action-btn" onclick="analyzeQuickUser('nasa')">@nasa</button>
          <button class="quick-action-btn" onclick="analyzeQuickUser('billgates')">@billgates</button>
          <button class="quick-action-btn" onclick="analyzeQuickUser('kanyewest')">@kanyewest</button>
          <button class="quick-action-btn" onclick="analyzeQuickUser('drew_mailen')">@drew_mailen</button>
        </div>

        <div class="chat-messages" id="chatMessages">
          <div class="chat-message santa">
            <div class="chat-message-avatar">üéÖ</div>
            <div class="chat-message-content">
              <strong>Ho ho ho!</strong> Welcome to Santa's Social Media Review Station! üéÑ
              <br><br>
              Just type a Twitter username (like <em>@elonmusk</em>) and I'll give you the full rundown on whether they've been naughty or nice online!
              <br><br>
              I'll tell you if they're a <strong>Shit Poster</strong>, <strong>Reply Guy</strong>, <strong>Brain Rot</strong> case, or maybe even one of the <strong>Wholesome</strong> ones! üéÅ
            </div>
          </div>
        </div>

        <div class="chat-input-area">
          <input 
            type="text" 
            class="chat-input" 
            id="chatInput" 
            placeholder="Type a username (e.g., @elonmusk) or ask Santa anything..."
            autocomplete="off"
          >
          <button class="chat-send-btn" id="chatSendBtn" onclick="sendChatMessage()">
            <span>üéÅ</span> Send
          </button>
        </div>
      </div>

      <footer style="margin-top: 40px;">
        <p>üéÑ Powered by Claude AI ‚Ä¢ Santa's little helper ü§ñ</p>
      </footer>
    </div><!-- End Santa Chat View -->
  </div>

  <script>
    // Create snowflakes
    function createSnowflakes() {
      const container = document.getElementById('snowflakes');
      const snowflakeChars = ['‚ùÑ', '‚ùÖ', '‚ùÜ', '‚úª', '‚úº', '‚ùâ'];
      for (let i = 0; i < 40; i++) {
        const snowflake = document.createElement('div');
        snowflake.className = 'snowflake';
        snowflake.textContent = snowflakeChars[Math.floor(Math.random() * snowflakeChars.length)];
        snowflake.style.left = Math.random() * 100 + '%';
        snowflake.style.animationDuration = (Math.random() * 3 + 5) + 's';
        snowflake.style.animationDelay = Math.random() * 5 + 's';
        snowflake.style.fontSize = (Math.random() * 1 + 0.5) + 'em';
        snowflake.style.opacity = Math.random() * 0.6 + 0.4;
        container.appendChild(snowflake);
      }
    }
    createSnowflakes();

    document.getElementById('usernameInput').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') analyzeUser();
    });

    const SOURCE_CONFIG = {
      twitter: { icon: 'ùïè', name: 'Twitter', color: '#1da1f2', weight: 0.30 },
      reddit: { icon: 'üî¥', name: 'Reddit', color: '#ff4500', weight: 0.30 },
      news: { icon: 'üì∞', name: 'News', color: '#607d8b', weight: 0.30 },
      github: { icon: 'üêô', name: 'GitHub', color: '#6e5494', weight: 0.10 }
    };

    const SCORING_INFO = {
      twitter: {
        formula: 'Score = 50 + (niceKeywords - naughtyKeywords) √ó 5',
        description: 'Analyzes tweet content for positive and negative sentiment keywords.',
        factors: [
          { name: 'Nice Keywords', key: 'niceCount', icon: 'üòá', type: 'nice', desc: 'Words like: love, grateful, thank you, amazing, help' },
          { name: 'Naughty Keywords', key: 'naughtyCount', icon: 'üòà', type: 'naughty', desc: 'Words like: hate, stupid, terrible, annoying, loser' }
        ]
      },
      reddit: {
        formula: 'Score = 50 + (niceKeywords - naughtyKeywords) √ó 3 + karmaBonus',
        description: 'Analyzes Reddit comments plus karma scoring (negative karma = naughty, high karma = nice).',
        factors: [
          { name: 'Nice Keywords', key: 'niceCount', icon: 'üòá', type: 'nice', desc: 'Positive sentiment in comments' },
          { name: 'Naughty Keywords', key: 'naughtyCount', icon: 'üòà', type: 'naughty', desc: 'Negative sentiment in comments' },
          { name: 'Comments Analyzed', key: 'commentsAnalyzed', icon: 'üí¨', type: 'neutral', desc: 'Total comments checked' }
        ]
      },
      news: {
        formula: 'Score = 50 + (niceKeywords - naughtyKeywords) √ó 4',
        description: 'Searches news mentions for scandal/controversy vs awards/charity coverage.',
        factors: [
          { name: 'Nice Mentions', key: 'niceCount', icon: 'üèÜ', type: 'nice', desc: 'awarded, honored, charity, hero, praised' },
          { name: 'Naughty Mentions', key: 'naughtyCount', icon: 'üìõ', type: 'naughty', desc: 'scandal, controversy, arrested, lawsuit, fraud' },
          { name: 'Snippets Analyzed', key: 'snippetsAnalyzed', icon: 'üìÑ', type: 'neutral', desc: 'News articles checked' }
        ]
      },
      github: {
        formula: 'Score = 50 + repoPoints + followerPoints + activityPoints',
        description: 'GitHub contributions are inherently "nice" - building and sharing code helps the community!',
        factors: [
          { name: 'Public Repos', key: 'repos', icon: 'üìÅ', type: 'nice', desc: '+2 points per repo (max 20)' },
          { name: 'Followers', key: 'followers', icon: 'üë•', type: 'nice', desc: '+1 point per follower (max 15)' },
          { name: 'Recent Activity', key: 'recentActivity', icon: '‚ö°', type: 'nice', desc: 'Push events, PRs, issues' }
        ]
      }
    };

    let currentData = null;

    function switchTab(tabId) {
      // Update nav buttons
      document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
      document.querySelector(`.tab-btn.${tabId}`).classList.add('active');

      // Update content
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
      document.getElementById(`tab-${tabId}`).classList.add('active');
    }

    async function analyzeUser() {
      const username = document.getElementById('usernameInput').value.trim();
      if (!username) {
        showError('Please enter a username');
        return;
      }

      const btn = document.getElementById('analyzeBtn');
      const loading = document.getElementById('loading');
      const results = document.getElementById('results');
      const error = document.getElementById('errorMessage');

      btn.disabled = true;
      loading.classList.add('active');
      results.classList.remove('active');
      error.classList.remove('active');

      try {
        const response = await fetch('/api/analyze-all', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username })
        });

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.error || 'Failed to analyze user');
        }

        currentData = data;
        displayResults(data);
      } catch (err) {
        showError(err.message);
      } finally {
        btn.disabled = false;
        loading.classList.remove('active');
      }
    }

    function showError(message) {
      const error = document.getElementById('errorMessage');
      error.textContent = '‚ùå ' + message;
      error.classList.add('active');
    }

    function displayResults(data) {
      const { user, finalScore, verdict, breakdown, sourcesFound, weights } = data;

      // User info
      const avatarEl = document.getElementById('userAvatar');
      avatarEl.dataset.username = user.username;
      avatarEl.src = user.profileImage || 'https://unavatar.io/' + user.username;
      document.getElementById('userName').textContent = user.name || user.username;
      document.getElementById('userHandle').textContent = '@' + user.username;
      document.getElementById('userFollowers').textContent = formatNumber(user.followers) + ' followers';
      document.getElementById('userTweets').textContent = formatNumber(user.tweets) + ' tweets';

      // Verdict
      const verdictCard = document.getElementById('verdictCard');
      const isNice = verdict === 'NICE';
      verdictCard.className = 'verdict-card ' + (isNice ? 'nice' : 'naughty');
      document.getElementById('verdictIcon').textContent = isNice ? 'üòá' : 'üòà';
      document.getElementById('verdictText').textContent = verdict + '!';
      document.getElementById('scoreNumber').textContent = finalScore;

      // Score indicator
      setTimeout(() => {
        document.getElementById('scoreIndicator').style.left = finalScore + '%';
      }, 100);

      // Stamps for naughty/nice
      const shitpostStamp = document.getElementById('shitpostStamp');
      const shitpostCheckbox = document.getElementById('shitpostCheckbox');
      const brainrotStamp = document.getElementById('brainrotStamp');
      const brainrotCheckbox = document.getElementById('brainrotCheckbox');
      const replyguyStamp = document.getElementById('replyguyStamp');
      const replyguyCheckbox = document.getElementById('replyguyCheckbox');
      
      // Hide all stamps first
      shitpostStamp.classList.remove('visible');
      shitpostCheckbox.classList.remove('checked');
      brainrotStamp.classList.remove('visible');
      brainrotCheckbox.classList.remove('checked');
      replyguyStamp.classList.remove('visible');
      replyguyCheckbox.classList.remove('checked');
      
      if (!isNice) {
        // NAUGHTY: Randomly pick Shit Poster OR Brain Rot
        if (Math.random() < 0.5) {
          shitpostStamp.classList.add('visible');
          shitpostCheckbox.classList.add('checked');
        } else {
          brainrotStamp.classList.add('visible');
          brainrotCheckbox.classList.add('checked');
        }
      } else {
        // NICE: Show Reply Guy stamp
        replyguyStamp.classList.add('visible');
        replyguyCheckbox.classList.add('checked');
      }

      // Update tab status indicators and hide tabs for unfound sources
      ['twitter', 'reddit', 'news', 'github'].forEach(source => {
        const found = breakdown[source] && breakdown[source].found !== false;
        const tabBtn = document.querySelector(`.tab-btn.${source}`);
        const statusEl = document.getElementById(`${source}Status`);
        
        if (found) {
          tabBtn.classList.remove('hidden');
          tabBtn.removeAttribute('aria-hidden');
          tabBtn.disabled = false;
          statusEl.textContent = '‚úì';
          statusEl.className = 'tab-status found';
        } else {
          // Hide the tab entirely if source not found
          tabBtn.classList.add('hidden');
          tabBtn.setAttribute('aria-hidden', 'true');
          tabBtn.disabled = true;
          statusEl.textContent = '';
        }
      });

      // Render Overview Tab
      renderOverviewTab(breakdown, weights, finalScore);

      // Render Source Detail Tabs
      renderSourceTab('twitter', breakdown.twitter);
      renderSourceTab('reddit', breakdown.reddit);
      renderSourceTab('news', breakdown.news);
      renderSourceTab('github', breakdown.github);

      document.getElementById('sourcesCount').textContent = `Analyzed ${sourcesFound} platform${sourcesFound !== 1 ? 's' : ''}`;
      document.getElementById('results').classList.add('active');

      // Reset to overview tab
      switchTab('overview');
    }

    function renderOverviewTab(breakdown, weights, finalScore) {
      const overviewGrid = document.getElementById('overviewGrid');
      overviewGrid.innerHTML = '';

      const breakdownBars = document.getElementById('breakdownBars');
      breakdownBars.innerHTML = '';

      let totalContribution = 0;
      let foundSourcesCount = 0;

      ['twitter', 'reddit', 'news', 'github'].forEach(source => {
        const config = SOURCE_CONFIG[source];
        const sourceData = breakdown[source];
        const found = sourceData && sourceData.found !== false;
        
        // Skip this source entirely if not found
        if (!found) {
          return;
        }
        
        foundSourcesCount++;
        const score = sourceData.score;
        const sourceVerdict = sourceData.verdict;
        const weight = weights[source] ? Math.round(weights[source] * 100) : 0;

        // Calculate contribution
        const contribution = Math.round(score * weights[source]);
        totalContribution += contribution;

        // Overview card
        const card = document.createElement('div');
        card.className = `source-card ${source} found`;
        card.onclick = () => switchTab(source);
        card.innerHTML = `
          <div class="source-icon">${config.icon}</div>
          <div class="source-name">${config.name}</div>
          <div class="source-score" style="color: ${config.color}">${score}</div>
          <div class="source-weight">Weight: ${weight}%</div>
          <div class="source-verdict ${sourceVerdict.toLowerCase()}">${sourceVerdict}</div>
        `;
        overviewGrid.appendChild(card);

        // Breakdown bar
        const barContainer = document.createElement('div');
        barContainer.className = 'breakdown-bar-container';
        barContainer.innerHTML = `
          <div class="breakdown-label">
            <span>${config.icon} ${config.name} (${weight}% weight)</span>
            <span>${score}/100 ‚Üí +${contribution} pts</span>
          </div>
          <div class="breakdown-bar">
            <div class="breakdown-fill ${source}" style="width: ${score}%">${score > 15 ? score : ''}</div>
          </div>
        `;
        breakdownBars.appendChild(barContainer);
      });
      
      // Adjust grid based on number of found sources
      if (foundSourcesCount <= 3) {
        overviewGrid.style.gridTemplateColumns = `repeat(${foundSourcesCount}, 1fr)`;
      } else {
        overviewGrid.style.gridTemplateColumns = 'repeat(4, 1fr)';
      }
    }

    function renderSourceTab(source, data) {
      const tabContent = document.getElementById(`tab-${source}`);
      const config = SOURCE_CONFIG[source];
      const info = SCORING_INFO[source];

      if (!data || data.found === false) {
        tabContent.innerHTML = `
          <div class="not-found-message">
            <div class="icon">üîç</div>
            <h3>No ${config.name} Data Found</h3>
            <p>We couldn't find a ${config.name} account or data for this username.</p>
            <p style="margin-top: 10px; font-size: 0.85rem;">This source won't affect the final score.</p>
          </div>
        `;
        return;
      }

      const score = data.score || 50;
      const verdict = data.verdict || 'NICE';
      const isNice = verdict === 'NICE';

      let factorsHTML = '';
      info.factors.forEach(factor => {
        const value = data[factor.key] !== undefined ? data[factor.key] : '‚Äî';
        factorsHTML += `
          <div class="scoring-factor ${factor.type}-factor">
            <div class="scoring-factor-title">${factor.icon} ${factor.name}</div>
            <div class="scoring-factor-value">${value}</div>
            <div class="scoring-factor-desc">${factor.desc}</div>
          </div>
        `;
      });

      tabContent.innerHTML = `
        <div class="source-header">
          <div class="source-header-icon">${config.icon}</div>
          <div class="source-header-info">
            <h3>${config.name} Analysis</h3>
            <p style="opacity: 0.7; font-size: 0.9rem;">${info.description}</p>
          </div>
          <div class="source-header-score" style="color: ${isNice ? 'var(--nice-green)' : 'var(--naughty-red)'}">
            ${score}/100
          </div>
        </div>

        <div class="scoring-explanation">
          <h4>üìê How This Score Was Calculated</h4>
          <div class="scoring-factors">
            ${factorsHTML}
          </div>
          <div class="formula-box">
            ${info.formula}
          </div>
        </div>

        <div style="text-align: center; margin-top: 20px;">
          <div class="source-verdict ${verdict.toLowerCase()}" style="font-size: 1.1rem; padding: 8px 20px;">
            ${verdict === 'NICE' ? 'üòá' : 'üòà'} ${verdict}
          </div>
          <p style="margin-top: 10px; opacity: 0.7; font-size: 0.85rem;">
            Contributes ${Math.round(SOURCE_CONFIG[source].weight * 100)}% to final score 
            (${Math.round(score * SOURCE_CONFIG[source].weight)} weighted points)
          </p>
        </div>
      `;
    }

    function formatNumber(num) {
      if (num === '‚Äî' || num === undefined) return '‚Äî';
      if (typeof num === 'string') return num;
      if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
      if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
      return num.toString();
    }

    // ==========================================
    // MAIN VIEW NAVIGATION
    // ==========================================
    function switchMainView(view, btn) {
      // Update nav buttons
      document.querySelectorAll('.main-nav-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');

      // Update views
      document.querySelectorAll('.main-view').forEach(v => v.classList.remove('active'));
      document.getElementById(`view-${view}`).classList.add('active');
    }

    // ==========================================
    // SANTA CHAT FUNCTIONALITY
    // ==========================================
    let chatHistory = [];

    document.getElementById('chatInput').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') sendChatMessage();
    });

    function analyzeQuickUser(username) {
      document.getElementById('chatInput').value = `@${username}`;
      sendChatMessage();
    }

    async function sendChatMessage() {
      const input = document.getElementById('chatInput');
      const message = input.value.trim();
      
      if (!message) return;

      const chatMessages = document.getElementById('chatMessages');
      const sendBtn = document.getElementById('chatSendBtn');

      // Extract username if present
      const usernameMatch = message.match(/@?(\w+)/);
      const username = usernameMatch ? usernameMatch[1] : null;

      // Add user message to chat
      addChatMessage('user', message);
      input.value = '';
      sendBtn.disabled = true;

      // Show typing indicator
      const typingId = showTypingIndicator();

      try {
        const response = await fetch('/api/santa-chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            username: username,
            message: message,
            conversationHistory: chatHistory
          })
        });

        const data = await response.json();

        // Remove typing indicator
        removeTypingIndicator(typingId);

        if (!response.ok) {
          throw new Error(data.error || 'Santa is busy!');
        }

        // Add Santa's response
        addChatMessage('santa', data.message);

        // Update conversation history for context
        chatHistory.push({ role: 'user', content: message });
        chatHistory.push({ role: 'assistant', content: data.message });

        // Keep only last 10 messages for context
        if (chatHistory.length > 20) {
          chatHistory = chatHistory.slice(-20);
        }

      } catch (error) {
        removeTypingIndicator(typingId);
        addChatMessage('santa', `üéÖ Oops! ${error.message} Please try again!`);
      } finally {
        sendBtn.disabled = false;
      }
    }

    function addChatMessage(role, content) {
      const chatMessages = document.getElementById('chatMessages');
      
      const messageDiv = document.createElement('div');
      messageDiv.className = `chat-message ${role}`;
      
      // Parse markdown-like formatting
      let formattedContent = content
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/\*(.*?)\*/g, '<em>$1</em>')
        .replace(/`(.*?)`/g, '<code>$1</code>')
        .replace(/\n/g, '<br>');

      messageDiv.innerHTML = `
        <div class="chat-message-avatar">${role === 'santa' ? 'üéÖ' : 'üë§'}</div>
        <div class="chat-message-content">${formattedContent}</div>
      `;
      
      chatMessages.appendChild(messageDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function showTypingIndicator() {
      const chatMessages = document.getElementById('chatMessages');
      const typingDiv = document.createElement('div');
      typingDiv.className = 'chat-message santa';
      typingDiv.id = 'typing-indicator';
      typingDiv.innerHTML = `
        <div class="chat-message-avatar">üéÖ</div>
        <div class="chat-typing">
          <span>Santa is checking the list</span>
          <div class="typing-dots">
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
          </div>
        </div>
      `;
      chatMessages.appendChild(typingDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
      return 'typing-indicator';
    }

    function removeTypingIndicator(id) {
      const typing = document.getElementById(id);
      if (typing) typing.remove();
    }
  </script>
</body>
</html>
