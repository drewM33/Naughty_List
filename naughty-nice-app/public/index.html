<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üéÖ Naughty or Nice? - Multi-Platform Compliance Engine</title>
  <link href="https://fonts.googleapis.com/css2?family=Mountains+of+Christmas:wght@400;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --nice-green: #2ecc71;
      --naughty-red: #e74c3c;
      --gold: #f39c12;
      --snow-white: #ecf0f1;
      --dark-green: #1a472a;
      --christmas-red: #c41e3a;
      --twitter-blue: #1da1f2;
      --reddit-orange: #ff4500;
      --github-purple: #6e5494;
      --news-gray: #607d8b;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Poppins', sans-serif;
      min-height: 100vh;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      color: white;
      overflow-x: hidden;
    }

    .snowflakes {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none; z-index: 1; overflow: hidden;
    }

    .snowflake {
      position: absolute; top: -10px; color: white; font-size: 1em;
      animation: fall linear infinite; opacity: 0.8;
    }

    @keyframes fall { to { transform: translateY(100vh) rotate(360deg); } }

    .container {
      max-width: 1200px; margin: 0 auto; padding: 50px 30px;
      position: relative; z-index: 10;
    }

    header { text-align: center; margin-bottom: 50px; }

    h1 {
      font-family: 'Mountains of Christmas', cursive;
      font-size: 5rem; color: var(--christmas-red);
      text-shadow: 4px 4px 0 var(--gold), 8px 8px 0 rgba(0,0,0,0.2);
      margin-bottom: 15px; animation: glow 2s ease-in-out infinite alternate;
    }

    @keyframes glow {
      from { text-shadow: 3px 3px 0 var(--gold), 6px 6px 0 rgba(0,0,0,0.2), 0 0 20px rgba(243, 156, 18, 0.3); }
      to { text-shadow: 3px 3px 0 var(--gold), 6px 6px 0 rgba(0,0,0,0.2), 0 0 40px rgba(243, 156, 18, 0.6); }
    }

    .subtitle { font-size: 1.5rem; color: var(--snow-white); opacity: 0.9; }

    .platforms-badges {
      display: flex; justify-content: center; gap: 15px; margin-top: 15px; flex-wrap: wrap;
    }

    .platform-badge {
      padding: 10px 20px; border-radius: 25px; font-size: 1.1rem; font-weight: 500;
      display: flex; align-items: center; gap: 10px;
    }

    .platform-badge.twitter { background: rgba(29, 161, 242, 0.3); border: 1px solid var(--twitter-blue); }
    .platform-badge.reddit { background: rgba(255, 69, 0, 0.3); border: 1px solid var(--reddit-orange); }
    .platform-badge.news { background: rgba(96, 125, 139, 0.3); border: 1px solid var(--news-gray); }
    .platform-badge.github { background: rgba(110, 84, 148, 0.3); border: 1px solid var(--github-purple); }

    .search-section {
      background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px);
      border-radius: 25px; padding: 45px; margin-bottom: 40px;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .search-box { display: flex; gap: 20px; max-width: 800px; margin: 0 auto; }

    .search-input {
      flex: 1; padding: 22px 32px; font-size: 1.4rem; border: none;
      border-radius: 50px; background: rgba(255, 255, 255, 0.95);
      color: #333; outline: none; transition: all 0.3s ease;
    }

    .search-input::placeholder { color: #999; }
    .search-input:focus { transform: scale(1.02); box-shadow: 0 0 30px rgba(255, 255, 255, 0.3); }

    .search-btn {
      padding: 22px 50px; font-size: 1.3rem; font-weight: 600; border: none;
      border-radius: 50px; background: linear-gradient(135deg, var(--christmas-red), #a01830);
      color: white; cursor: pointer; transition: all 0.3s ease;
      display: flex; align-items: center; gap: 12px;
    }

    .search-btn:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(196, 30, 58, 0.4); }
    .search-btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }

    .loading { display: none; text-align: center; padding: 70px; }
    .loading.active { display: block; }

    .loading-spinner {
      width: 90px; height: 90px; border: 5px solid rgba(255, 255, 255, 0.1);
      border-top-color: var(--gold); border-radius: 50%;
      animation: spin 1s linear infinite; margin: 0 auto 25px;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    .loading-text { font-size: 1.5rem; color: var(--snow-white); }
    .loading-sources { margin-top: 25px; font-size: 1.2rem; opacity: 0.8; }

    .results { display: none; animation: fadeIn 0.5s ease; }
    .results.active { display: block; }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

    .user-card {
      background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px);
      border-radius: 25px; padding: 35px; margin-bottom: 35px;
      display: flex; align-items: center; gap: 30px;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .user-avatar {
      width: 120px; height: 120px; border-radius: 50%;
      border: 5px solid var(--gold); object-fit: cover;
    }

    .user-info h2 { font-size: 2.2rem; margin-bottom: 8px; }
    .user-handle { color: var(--gold); font-size: 1.3rem; margin-bottom: 10px; }
    .user-stats { display: flex; gap: 25px; font-size: 1.1rem; opacity: 0.8; }

    .verdict-card {
      background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px);
      border-radius: 25px; padding: 50px; text-align: center; margin-bottom: 35px;
      border: 2px solid rgba(255, 255, 255, 0.2); position: relative; overflow: hidden;
    }

    .verdict-card.nice { border-color: var(--nice-green); box-shadow: 0 0 60px rgba(46, 204, 113, 0.3); }
    .verdict-card.naughty { border-color: var(--naughty-red); box-shadow: 0 0 60px rgba(231, 76, 60, 0.3); }

    .verdict-icon { font-size: 7rem; margin-bottom: 20px; animation: bounce 1s ease infinite; }
    @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

    .verdict-text {
      font-family: 'Mountains of Christmas', cursive;
      font-size: 5rem; font-weight: 700; margin-bottom: 15px;
    }

    .verdict-card.nice .verdict-text { color: var(--nice-green); }
    .verdict-card.naughty .verdict-text { color: var(--naughty-red); }

    .score-display { font-size: 1.8rem; margin-bottom: 30px; }
    .score-number { font-size: 3.5rem; font-weight: 700; color: var(--gold); }

    .score-bar {
      width: 100%; max-width: 500px; height: 22px;
      background: linear-gradient(90deg, var(--naughty-red) 0%, var(--gold) 50%, var(--nice-green) 100%);
      border-radius: 11px; margin: 0 auto; position: relative;
    }

    .score-indicator {
      position: absolute; top: -10px; width: 42px; height: 42px;
      background: white; border-radius: 50%; transform: translateX(-50%);
      display: flex; align-items: center; justify-content: center;
      font-size: 1.4rem; box-shadow: 0 4px 20px rgba(0,0,0,0.3); transition: left 1s ease;
    }

    /* Tabs Navigation */
    .tabs-container {
      background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px);
      border-radius: 25px; margin-bottom: 35px;
      border: 1px solid rgba(255, 255, 255, 0.2); overflow: hidden;
    }

    .tabs-nav {
      display: flex; border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      overflow-x: auto;
    }

    .tab-btn {
      flex: 1; padding: 20px 28px; background: none; border: none;
      color: rgba(255, 255, 255, 0.6); font-size: 1.2rem; font-weight: 500;
      cursor: pointer; transition: all 0.3s ease;
      display: flex; align-items: center; justify-content: center; gap: 12px;
      min-width: 140px; white-space: nowrap;
    }

    .tab-btn:hover { background: rgba(255, 255, 255, 0.05); color: white; }
    .tab-btn.active { background: rgba(255, 255, 255, 0.1); color: white; }
    .tab-btn.hidden { display: none !important; visibility: hidden !important; }
    .tab-btn.active.twitter { border-bottom: 4px solid var(--twitter-blue); }
    .tab-btn.active.reddit { border-bottom: 4px solid var(--reddit-orange); }
    .tab-btn.active.news { border-bottom: 4px solid var(--news-gray); }
    .tab-btn.active.github { border-bottom: 4px solid var(--github-purple); }
    .tab-btn.active.overview { border-bottom: 4px solid var(--gold); }

    .tab-icon { font-size: 1.6rem; }
    .tab-status { font-size: 0.9rem; margin-left: 8px; }
    .tab-status.found { color: var(--nice-green); }
    .tab-status.not-found { color: var(--naughty-red); }

    .tab-content { display: none; padding: 35px; }
    .tab-content.active { display: block; animation: fadeIn 0.3s ease; }

    /* Overview Tab */
    .overview-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 35px; }

    .source-card {
      background: rgba(0, 0, 0, 0.2); border-radius: 20px; padding: 28px;
      text-align: center; border: 3px solid transparent; transition: all 0.3s ease;
      cursor: pointer;
    }

    .source-card:hover { transform: translateY(-5px); }
    .source-card.found { border-color: rgba(255, 255, 255, 0.3); }
    .source-card.not-found { opacity: 0.5; }

    .source-card.twitter.found { border-color: var(--twitter-blue); }
    .source-card.reddit.found { border-color: var(--reddit-orange); }
    .source-card.news.found { border-color: var(--news-gray); }
    .source-card.github.found { border-color: var(--github-purple); }

    .source-icon { font-size: 3rem; margin-bottom: 15px; }
    .source-name { font-size: 1.2rem; font-weight: 600; margin-bottom: 12px; }
    .source-score { font-size: 2.5rem; font-weight: 700; }
    .source-weight { font-size: 1rem; opacity: 0.7; margin-top: 8px; }
    .source-verdict { font-size: 1rem; margin-top: 8px; padding: 6px 16px; border-radius: 15px; display: inline-block; }
    .source-verdict.nice { background: rgba(46, 204, 113, 0.3); color: var(--nice-green); }
    .source-verdict.naughty { background: rgba(231, 76, 60, 0.3); color: var(--naughty-red); }

    /* Weighted Breakdown Chart */
    .breakdown-chart { margin-top: 35px; }
    .breakdown-title { font-size: 1.5rem; margin-bottom: 20px; text-align: center; }

    .breakdown-bar-container { margin-bottom: 18px; }
    .breakdown-label { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 1.15rem; }
    .breakdown-bar { height: 32px; background: rgba(255, 255, 255, 0.1); border-radius: 16px; overflow: hidden; position: relative; }
    .breakdown-fill { height: 100%; border-radius: 16px; transition: width 1s ease; display: flex; align-items: center; justify-content: flex-end; padding-right: 14px; font-size: 1rem; font-weight: 600; }
    .breakdown-fill.twitter { background: linear-gradient(90deg, rgba(29, 161, 242, 0.3), var(--twitter-blue)); }
    .breakdown-fill.reddit { background: linear-gradient(90deg, rgba(255, 69, 0, 0.3), var(--reddit-orange)); }
    .breakdown-fill.news { background: linear-gradient(90deg, rgba(96, 125, 139, 0.3), var(--news-gray)); }
    .breakdown-fill.github { background: linear-gradient(90deg, rgba(110, 84, 148, 0.3), var(--github-purple)); }

    /* Source Detail Tabs */
    .source-header { display: flex; align-items: center; gap: 20px; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); }
    .source-header-icon { font-size: 3.5rem; }
    .source-header-info h3 { font-size: 1.8rem; margin-bottom: 8px; }
    .source-header-score { font-size: 2.8rem; font-weight: 700; margin-left: auto; }

    .scoring-explanation { background: rgba(0, 0, 0, 0.2); border-radius: 20px; padding: 30px; margin-bottom: 25px; }
    .scoring-explanation h4 { font-size: 1.3rem; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }

    .scoring-factors { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }
    .scoring-factor { background: rgba(255, 255, 255, 0.05); border-radius: 15px; padding: 22px; }
    .scoring-factor-title { font-size: 1.1rem; font-weight: 600; margin-bottom: 12px; display: flex; align-items: center; gap: 10px; }
    .scoring-factor-value { font-size: 2.2rem; font-weight: 700; }
    .scoring-factor-desc { font-size: 0.95rem; opacity: 0.7; margin-top: 8px; }

    .nice-factor .scoring-factor-value { color: var(--nice-green); }
    .naughty-factor .scoring-factor-value { color: var(--naughty-red); }

    .keywords-section { margin-top: 25px; }
    .keywords-section h4 { font-size: 1.2rem; margin-bottom: 15px; }
    .keywords-list { display: flex; flex-wrap: wrap; gap: 12px; }
    .keyword-tag { padding: 8px 18px; border-radius: 25px; font-size: 1rem; }
    .keyword-tag.nice { background: rgba(46, 204, 113, 0.2); color: var(--nice-green); border: 1px solid rgba(46, 204, 113, 0.4); }
    .keyword-tag.naughty { background: rgba(231, 76, 60, 0.2); color: var(--naughty-red); border: 1px solid rgba(231, 76, 60, 0.4); }

    .not-found-message { text-align: center; padding: 60px; opacity: 0.7; }
    .not-found-message .icon { font-size: 4rem; margin-bottom: 20px; }

    .formula-box { background: rgba(0, 0, 0, 0.3); border-radius: 12px; padding: 20px; margin-top: 20px; font-family: monospace; font-size: 1.1rem; text-align: center; }

    .error-message {
      background: rgba(231, 76, 60, 0.2); border: 1px solid var(--naughty-red);
      border-radius: 15px; padding: 20px; text-align: center; color: white; display: none;
    }

    .error-message.active { display: block; }

    footer { text-align: center; margin-top: 50px; opacity: 0.7; font-size: 1.1rem; }

    @media (max-width: 768px) {
      h1 { font-size: 3rem; }
      .subtitle { font-size: 1.2rem; }
      .platform-badge { font-size: 0.95rem; padding: 8px 14px; }
      .search-box { flex-direction: column; }
      .search-input { font-size: 1.2rem; padding: 18px 24px; }
      .search-btn { font-size: 1.1rem; padding: 18px 35px; justify-content: center; }
      .user-card { flex-direction: column; text-align: center; }
      .user-avatar { width: 100px; height: 100px; }
      .user-info h2 { font-size: 1.8rem; }
      .verdict-icon { font-size: 5rem; }
      .verdict-text { font-size: 3.5rem; }
      .score-number { font-size: 2.5rem; }
      .overview-grid { grid-template-columns: repeat(2, 1fr); }
      .source-icon { font-size: 2.2rem; }
      .source-score { font-size: 2rem; }
      .scoring-factors { grid-template-columns: 1fr; }
      .tabs-nav { flex-wrap: nowrap; }
      .tab-btn { min-width: 100px; padding: 16px 14px; font-size: 1rem; }
      .tab-icon { font-size: 1.3rem; }
    }
  </style>
</head>
<body>
  <div class="snowflakes" id="snowflakes"></div>
  
  <div class="container">
    <header>
      <h1>üéÖ Naughty or Nice?</h1>
      <p class="subtitle">Santa's Official Naughty or Nice Score Card</p>
      <div class="platforms-badges">
        <span class="platform-badge twitter">ùïè Twitter (30%)</span>
        <span class="platform-badge reddit">üî¥ Reddit (30%)</span>
        <span class="platform-badge news">üì∞ News (30%)</span>
        <span class="platform-badge github">üêô GitHub (10%)</span>
      </div>
    </header>

    <div class="search-section">
      <div class="search-box">
        <input 
          type="text" 
          class="search-input" 
          id="usernameInput" 
          placeholder="Enter username (e.g., elonmusk, nasa, billgates)"
          autocomplete="off"
        >
        <button class="search-btn" id="analyzeBtn" onclick="analyzeUser()">
          <span>üîç</span> Analyze
        </button>
      </div>
    </div>

    <div class="loading" id="loading">
      <div class="loading-spinner"></div>
      <p class="loading-text">üéÑ Santa's elves are checking ALL the lists... üéÑ</p>
      <div class="loading-sources" id="loadingSources">
        Scanning Twitter, Reddit, News, and GitHub...
      </div>
    </div>

    <div class="error-message" id="errorMessage"></div>

    <div class="results" id="results">
      <div class="user-card">
        <img class="user-avatar" id="userAvatar" src="" alt="Profile" referrerpolicy="no-referrer" onerror="this.onerror=null; this.src='https://unavatar.io/' + (this.dataset.username || 'user');">
        <div class="user-info">
          <h2 id="userName"></h2>
          <p class="user-handle" id="userHandle"></p>
          <div class="user-stats">
            <span id="userFollowers"></span>
            <span id="userTweets"></span>
          </div>
        </div>
      </div>

      <div class="verdict-card" id="verdictCard">
        <div class="verdict-icon" id="verdictIcon"></div>
        <div class="verdict-text" id="verdictText"></div>
        <div class="score-display">
          Combined Score: <span class="score-number" id="scoreNumber"></span>/100
        </div>
        <div class="score-bar">
          <div class="score-indicator" id="scoreIndicator">üéÖ</div>
        </div>
      </div>

      <!-- Tabbed Interface -->
      <div class="tabs-container">
        <div class="tabs-nav" id="tabsNav">
          <button class="tab-btn overview active" onclick="switchTab('overview')">
            <span class="tab-icon">üìä</span> Overview
          </button>
          <button class="tab-btn twitter" onclick="switchTab('twitter')">
            <span class="tab-icon">ùïè</span> Twitter
            <span class="tab-status" id="twitterStatus"></span>
          </button>
          <button class="tab-btn reddit" onclick="switchTab('reddit')">
            <span class="tab-icon">üî¥</span> Reddit
            <span class="tab-status" id="redditStatus"></span>
          </button>
          <button class="tab-btn news" onclick="switchTab('news')">
            <span class="tab-icon">üì∞</span> News
            <span class="tab-status" id="newsStatus"></span>
          </button>
          <button class="tab-btn github" onclick="switchTab('github')">
            <span class="tab-icon">üêô</span> GitHub
            <span class="tab-status" id="githubStatus"></span>
          </button>
        </div>

        <!-- Overview Tab -->
        <div class="tab-content active" id="tab-overview">
          <div class="overview-grid" id="overviewGrid"></div>
          <div class="breakdown-chart">
            <div class="breakdown-title">üìà Weighted Score Contribution</div>
            <div id="breakdownBars"></div>
          </div>
        </div>

        <!-- Twitter Tab -->
        <div class="tab-content" id="tab-twitter"></div>

        <!-- Reddit Tab -->
        <div class="tab-content" id="tab-reddit"></div>

        <!-- News Tab -->
        <div class="tab-content" id="tab-news"></div>

        <!-- GitHub Tab -->
        <div class="tab-content" id="tab-github"></div>
      </div>
    </div>

    <footer>
      <p>üéÑ Made with holiday cheer for the MCP Jam 2024 üéÑ</p>
      <p id="sourcesCount">Analyzing 4 platforms</p>
    </footer>
  </div>

  <script>
    // Create snowflakes
    function createSnowflakes() {
      const container = document.getElementById('snowflakes');
      const snowflakeChars = ['‚ùÑ', '‚ùÖ', '‚ùÜ', '‚úª', '‚úº', '‚ùâ'];
      for (let i = 0; i < 40; i++) {
        const snowflake = document.createElement('div');
        snowflake.className = 'snowflake';
        snowflake.textContent = snowflakeChars[Math.floor(Math.random() * snowflakeChars.length)];
        snowflake.style.left = Math.random() * 100 + '%';
        snowflake.style.animationDuration = (Math.random() * 3 + 5) + 's';
        snowflake.style.animationDelay = Math.random() * 5 + 's';
        snowflake.style.fontSize = (Math.random() * 1 + 0.5) + 'em';
        snowflake.style.opacity = Math.random() * 0.6 + 0.4;
        container.appendChild(snowflake);
      }
    }
    createSnowflakes();

    document.getElementById('usernameInput').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') analyzeUser();
    });

    const SOURCE_CONFIG = {
      twitter: { icon: 'ùïè', name: 'Twitter', color: '#1da1f2', weight: 0.30 },
      reddit: { icon: 'üî¥', name: 'Reddit', color: '#ff4500', weight: 0.30 },
      news: { icon: 'üì∞', name: 'News', color: '#607d8b', weight: 0.30 },
      github: { icon: 'üêô', name: 'GitHub', color: '#6e5494', weight: 0.10 }
    };

    const SCORING_INFO = {
      twitter: {
        formula: 'Score = 50 + (niceKeywords - naughtyKeywords) √ó 5',
        description: 'Analyzes tweet content for positive and negative sentiment keywords.',
        factors: [
          { name: 'Nice Keywords', key: 'niceCount', icon: 'üòá', type: 'nice', desc: 'Words like: love, grateful, thank you, amazing, help' },
          { name: 'Naughty Keywords', key: 'naughtyCount', icon: 'üòà', type: 'naughty', desc: 'Words like: hate, stupid, terrible, annoying, loser' }
        ]
      },
      reddit: {
        formula: 'Score = 50 + (niceKeywords - naughtyKeywords) √ó 3 + karmaBonus',
        description: 'Analyzes Reddit comments plus karma scoring (negative karma = naughty, high karma = nice).',
        factors: [
          { name: 'Nice Keywords', key: 'niceCount', icon: 'üòá', type: 'nice', desc: 'Positive sentiment in comments' },
          { name: 'Naughty Keywords', key: 'naughtyCount', icon: 'üòà', type: 'naughty', desc: 'Negative sentiment in comments' },
          { name: 'Comments Analyzed', key: 'commentsAnalyzed', icon: 'üí¨', type: 'neutral', desc: 'Total comments checked' }
        ]
      },
      news: {
        formula: 'Score = 50 + (niceKeywords - naughtyKeywords) √ó 4',
        description: 'Searches news mentions for scandal/controversy vs awards/charity coverage.',
        factors: [
          { name: 'Nice Mentions', key: 'niceCount', icon: 'üèÜ', type: 'nice', desc: 'awarded, honored, charity, hero, praised' },
          { name: 'Naughty Mentions', key: 'naughtyCount', icon: 'üìõ', type: 'naughty', desc: 'scandal, controversy, arrested, lawsuit, fraud' },
          { name: 'Snippets Analyzed', key: 'snippetsAnalyzed', icon: 'üìÑ', type: 'neutral', desc: 'News articles checked' }
        ]
      },
      github: {
        formula: 'Score = 50 + repoPoints + followerPoints + activityPoints',
        description: 'GitHub contributions are inherently "nice" - building and sharing code helps the community!',
        factors: [
          { name: 'Public Repos', key: 'repos', icon: 'üìÅ', type: 'nice', desc: '+2 points per repo (max 20)' },
          { name: 'Followers', key: 'followers', icon: 'üë•', type: 'nice', desc: '+1 point per follower (max 15)' },
          { name: 'Recent Activity', key: 'recentActivity', icon: '‚ö°', type: 'nice', desc: 'Push events, PRs, issues' }
        ]
      }
    };

    let currentData = null;

    function switchTab(tabId) {
      // Update nav buttons
      document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
      document.querySelector(`.tab-btn.${tabId}`).classList.add('active');

      // Update content
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
      document.getElementById(`tab-${tabId}`).classList.add('active');
    }

    async function analyzeUser() {
      const username = document.getElementById('usernameInput').value.trim();
      if (!username) {
        showError('Please enter a username');
        return;
      }

      const btn = document.getElementById('analyzeBtn');
      const loading = document.getElementById('loading');
      const results = document.getElementById('results');
      const error = document.getElementById('errorMessage');

      btn.disabled = true;
      loading.classList.add('active');
      results.classList.remove('active');
      error.classList.remove('active');

      try {
        const response = await fetch('/api/analyze-all', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username })
        });

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.error || 'Failed to analyze user');
        }

        currentData = data;
        displayResults(data);
      } catch (err) {
        showError(err.message);
      } finally {
        btn.disabled = false;
        loading.classList.remove('active');
      }
    }

    function showError(message) {
      const error = document.getElementById('errorMessage');
      error.textContent = '‚ùå ' + message;
      error.classList.add('active');
    }

    function displayResults(data) {
      const { user, finalScore, verdict, breakdown, sourcesFound, weights } = data;

      // User info
      const avatarEl = document.getElementById('userAvatar');
      avatarEl.dataset.username = user.username;
      avatarEl.src = user.profileImage || 'https://unavatar.io/' + user.username;
      document.getElementById('userName').textContent = user.name || user.username;
      document.getElementById('userHandle').textContent = '@' + user.username;
      document.getElementById('userFollowers').textContent = formatNumber(user.followers) + ' followers';
      document.getElementById('userTweets').textContent = formatNumber(user.tweets) + ' tweets';

      // Verdict
      const verdictCard = document.getElementById('verdictCard');
      const isNice = verdict === 'NICE';
      verdictCard.className = 'verdict-card ' + (isNice ? 'nice' : 'naughty');
      document.getElementById('verdictIcon').textContent = isNice ? 'üòá' : 'üòà';
      document.getElementById('verdictText').textContent = verdict + '!';
      document.getElementById('scoreNumber').textContent = finalScore;

      // Score indicator
      setTimeout(() => {
        document.getElementById('scoreIndicator').style.left = finalScore + '%';
      }, 100);

      // Update tab status indicators and hide tabs for unfound sources
      ['twitter', 'reddit', 'news', 'github'].forEach(source => {
        const found = breakdown[source] && breakdown[source].found !== false;
        const tabBtn = document.querySelector(`.tab-btn.${source}`);
        const statusEl = document.getElementById(`${source}Status`);
        
        if (found) {
          tabBtn.classList.remove('hidden');
          tabBtn.removeAttribute('aria-hidden');
          tabBtn.disabled = false;
          statusEl.textContent = '‚úì';
          statusEl.className = 'tab-status found';
        } else {
          // Hide the tab entirely if source not found
          tabBtn.classList.add('hidden');
          tabBtn.setAttribute('aria-hidden', 'true');
          tabBtn.disabled = true;
          statusEl.textContent = '';
        }
      });

      // Render Overview Tab
      renderOverviewTab(breakdown, weights, finalScore);

      // Render Source Detail Tabs
      renderSourceTab('twitter', breakdown.twitter);
      renderSourceTab('reddit', breakdown.reddit);
      renderSourceTab('news', breakdown.news);
      renderSourceTab('github', breakdown.github);

      document.getElementById('sourcesCount').textContent = `Analyzed ${sourcesFound} platform${sourcesFound !== 1 ? 's' : ''}`;
      document.getElementById('results').classList.add('active');

      // Reset to overview tab
      switchTab('overview');
    }

    function renderOverviewTab(breakdown, weights, finalScore) {
      const overviewGrid = document.getElementById('overviewGrid');
      overviewGrid.innerHTML = '';

      const breakdownBars = document.getElementById('breakdownBars');
      breakdownBars.innerHTML = '';

      let totalContribution = 0;
      let foundSourcesCount = 0;

      ['twitter', 'reddit', 'news', 'github'].forEach(source => {
        const config = SOURCE_CONFIG[source];
        const sourceData = breakdown[source];
        const found = sourceData && sourceData.found !== false;
        
        // Skip this source entirely if not found
        if (!found) {
          return;
        }
        
        foundSourcesCount++;
        const score = sourceData.score;
        const sourceVerdict = sourceData.verdict;
        const weight = weights[source] ? Math.round(weights[source] * 100) : 0;

        // Calculate contribution
        const contribution = Math.round(score * weights[source]);
        totalContribution += contribution;

        // Overview card
        const card = document.createElement('div');
        card.className = `source-card ${source} found`;
        card.onclick = () => switchTab(source);
        card.innerHTML = `
          <div class="source-icon">${config.icon}</div>
          <div class="source-name">${config.name}</div>
          <div class="source-score" style="color: ${config.color}">${score}</div>
          <div class="source-weight">Weight: ${weight}%</div>
          <div class="source-verdict ${sourceVerdict.toLowerCase()}">${sourceVerdict}</div>
        `;
        overviewGrid.appendChild(card);

        // Breakdown bar
        const barContainer = document.createElement('div');
        barContainer.className = 'breakdown-bar-container';
        barContainer.innerHTML = `
          <div class="breakdown-label">
            <span>${config.icon} ${config.name} (${weight}% weight)</span>
            <span>${score}/100 ‚Üí +${contribution} pts</span>
          </div>
          <div class="breakdown-bar">
            <div class="breakdown-fill ${source}" style="width: ${score}%">${score > 15 ? score : ''}</div>
          </div>
        `;
        breakdownBars.appendChild(barContainer);
      });
      
      // Adjust grid based on number of found sources
      if (foundSourcesCount <= 3) {
        overviewGrid.style.gridTemplateColumns = `repeat(${foundSourcesCount}, 1fr)`;
      } else {
        overviewGrid.style.gridTemplateColumns = 'repeat(4, 1fr)';
      }
    }

    function renderSourceTab(source, data) {
      const tabContent = document.getElementById(`tab-${source}`);
      const config = SOURCE_CONFIG[source];
      const info = SCORING_INFO[source];

      if (!data || data.found === false) {
        tabContent.innerHTML = `
          <div class="not-found-message">
            <div class="icon">üîç</div>
            <h3>No ${config.name} Data Found</h3>
            <p>We couldn't find a ${config.name} account or data for this username.</p>
            <p style="margin-top: 10px; font-size: 0.85rem;">This source won't affect the final score.</p>
          </div>
        `;
        return;
      }

      const score = data.score || 50;
      const verdict = data.verdict || 'NICE';
      const isNice = verdict === 'NICE';

      let factorsHTML = '';
      info.factors.forEach(factor => {
        const value = data[factor.key] !== undefined ? data[factor.key] : '‚Äî';
        factorsHTML += `
          <div class="scoring-factor ${factor.type}-factor">
            <div class="scoring-factor-title">${factor.icon} ${factor.name}</div>
            <div class="scoring-factor-value">${value}</div>
            <div class="scoring-factor-desc">${factor.desc}</div>
          </div>
        `;
      });

      tabContent.innerHTML = `
        <div class="source-header">
          <div class="source-header-icon">${config.icon}</div>
          <div class="source-header-info">
            <h3>${config.name} Analysis</h3>
            <p style="opacity: 0.7; font-size: 0.9rem;">${info.description}</p>
          </div>
          <div class="source-header-score" style="color: ${isNice ? 'var(--nice-green)' : 'var(--naughty-red)'}">
            ${score}/100
          </div>
        </div>

        <div class="scoring-explanation">
          <h4>üìê How This Score Was Calculated</h4>
          <div class="scoring-factors">
            ${factorsHTML}
          </div>
          <div class="formula-box">
            ${info.formula}
          </div>
        </div>

        <div style="text-align: center; margin-top: 20px;">
          <div class="source-verdict ${verdict.toLowerCase()}" style="font-size: 1.1rem; padding: 8px 20px;">
            ${verdict === 'NICE' ? 'üòá' : 'üòà'} ${verdict}
          </div>
          <p style="margin-top: 10px; opacity: 0.7; font-size: 0.85rem;">
            Contributes ${Math.round(SOURCE_CONFIG[source].weight * 100)}% to final score 
            (${Math.round(score * SOURCE_CONFIG[source].weight)} weighted points)
          </p>
        </div>
      `;
    }

    function formatNumber(num) {
      if (num === '‚Äî' || num === undefined) return '‚Äî';
      if (typeof num === 'string') return num;
      if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
      if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
      return num.toString();
    }
  </script>
</body>
</html>
